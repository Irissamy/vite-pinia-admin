import{m as x,T as L,c as k,d as I}from"./ToastMessage-e518b5ae.js";import{k as N,l as m,m as C,_ as y,o as l,c as d,a as t,b as c,v as p,q as T,w as r,t as h,x as V,r as b,e as f,F as v,n as S,i as D}from"./index-b4625bce.js";const g=N("couponStore",{state:()=>({couponList:[],currentCoupon:{},toastMessages:[],isLoading:!1}),actions:{async getCoupon(e=1){const o=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupons/?page=${e}`;this.isLoading=!0,await m.get(o).then(s=>{s.data.success?this.couponList=s.data.coupons:this.toastMessages.push({style:"danger",title:"取得列表失敗",content:s.data.message.join("、")})}),this.isLoading=!1},async updateCoupon(e){this.currentCoupon=e;let o="https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon",s="post";this.isLoading=!0,e.isNew||(o=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon/${e.id}`,s="put"),await m[s](o,{data:this.currentCoupon}).then(u=>{u.data.success?(this.getCoupon(),this.toastMessages.push({style:"success",title:s==="post"?"新增成功":"編輯成功",content:""})):this.toastMessages.push({style:"danger",title:s==="post"?"新增失敗":"編輯失敗",content:u.data.message.join("、")})}),this.isLoading=!1},async deleteCoupon(e){const o=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon/${e}`;this.isLoading=!0,await m.delete(o).then(s=>{s.data.success?(this.getCoupon(),this.toastMessages.push({style:"success",title:"刪除成功",content:""})):this.toastMessages.push({style:"danger",title:"刪除失敗",content:s.data.message.join("、")})}),this.isLoading=!1}}}),U={mixins:[x],props:{coupon:{type:Object}},data(){return{couponInfo:{},due_date:""}},watch:{coupon(){this.couponInfo=this.coupon;const e=new Date(this.couponInfo.due_date*1e3).toISOString().split("T");[this.due_date]=e},due_date(){this.couponInfo.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{...C(g,["updateCoupon"])}},j={class:"modal fade",id:"cuponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},O={class:"modal-dialog",role:"document"},B={class:"modal-content"},A=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠卷"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),F={class:"modal-body"},q={class:"mb-3"},E=t("label",{for:"title"},"標題",-1),P={class:"mb-3"},z=t("label",{for:"coupon_code"},"優惠碼",-1),G={class:"mb-3"},H=t("label",{for:"due_date"},"到期日",-1),J={class:"mb-3"},K=t("label",{for:"price"},"折扣百分比",-1),Q={class:"mb-3"},R={class:"form-check"},W=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),X={class:"modal-footer"},Y=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close",-1);function Z(e,o,s,u,n,_){return l(),d("div",j,[t("div",O,[t("div",B,[A,t("div",F,[t("div",q,[E,c(t("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=a=>n.couponInfo.title=a)},null,512),[[p,n.couponInfo.title]])]),t("div",P,[z,c(t("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=a=>n.couponInfo.code=a)},null,512),[[p,n.couponInfo.code]])]),t("div",G,[H,c(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=a=>n.due_date=a)},null,512),[[p,n.due_date]])]),t("div",J,[K,c(t("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=a=>n.couponInfo.percent=a)},null,512),[[p,n.couponInfo.percent]])]),t("div",Q,[t("div",R,[c(t("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":o[4]||(o[4]=a=>n.couponInfo.is_enabled=a),"true-value":1,"false-value":0},null,512),[[T,n.couponInfo.is_enabled]]),W])])]),t("div",X,[Y,t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:o[5]||(o[5]=r(a=>e.updateCoupon(n.couponInfo),["prevent"]))},h(s.coupon.isNew===!0?"新增優惠卷":"編輯優惠券"),1)])])])],512)}const tt=y(U,[["render",Z]]),ot={components:{CouponModal:tt,ToastMessage:L},data(){return{currency:k,date:I,isNew:!1,currentCoupon:{}}},computed:{...V(g,["couponList","isLoading","toastMessages"])},methods:{...C(g,["getCoupon","deleteCoupon"]),openModal(e,o){e?(this.isNew=e,this.currentCoupon={is_enabled:0,percent:100,due_date:new Date().getTime()/1e3,isNew:this.isNew}):(this.isNew=!1,this.currentCoupon={...o,isNew:this.isNew}),this.$refs.CouponModal.showModal()}},created(){this.getCoupon()}},et=t("h4",{class:"fw-bold py-3 mb-4"},[t("span",{class:"text-muted fw-light fs-4"},"Pages /"),D(" Coupon 折扣碼")],-1),st={class:"card"},nt={class:"card-header d-flex align-items-center"},at=t("h5",{class:"mb-0"},"Coupon 折扣碼",-1),it={class:"ms-auto"},lt={class:"table-responsive text-nowrap"},dt={class:"table"},ct=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),ut={class:"table-border-bottom-0"},pt={key:0,class:"text-success"},rt={key:1,class:"text-muted"},ht={class:"btn-group"},_t=["onClick"],mt=["onClick"];function bt(e,o,s,u,n,_){const a=b("LoadingOverlay"),M=b("ToastMessage"),$=b("CouponModal");return l(),d(v,null,[f(a,{active:e.isLoading},null,8,["active"]),f(M,{"toast-msg":e.toastMessages},null,8,["toast-msg"]),et,t("div",st,[t("div",nt,[at,t("div",it,[t("button",{class:"btn btn-primary",type:"button",onClick:o[0]||(o[0]=r(i=>_.openModal(!0),["prevent"]))},"建立新的優惠券")])]),t("div",lt,[t("table",dt,[ct,t("tbody",ut,[(l(!0),d(v,null,S(e.couponList,i=>(l(),d("tr",{key:i.id},[t("td",null,h(i.title),1),t("td",null,h(i.percent)+"%",1),t("td",null,h(n.date(i.due_date)),1),t("td",null,[i.is_enabled===1?(l(),d("span",pt,"啟用")):(l(),d("span",rt,"未啟用"))]),t("td",null,[t("div",ht,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:r(w=>_.openModal(!1,i),["prevent"])},"編輯",8,_t),t("button",{class:"btn btn-outline-danger btn-sm",onClick:r(w=>e.deleteCoupon(i.id),["prevent"])},"刪除",8,mt)])])]))),128))])])])]),f($,{ref:"CouponModal",coupon:n.currentCoupon},null,8,["coupon"])],64)}const vt=y(ot,[["render",bt]]);export{vt as default};
