import{c as v,m as M}from"./modalMixins-520f885a.js";import{_ as f,o as a,c as d,a as t,t as s,F as m,n as g,i as y,k,l as b,x as w,m as D,r as _,b as p,y as C,d as Y,q as j}from"./index-a1dbf405.js";import{T as V}from"./ToastMessage-765da476.js";const I={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{currency:v,currentOrder:{user:{}},isPaid:!1}},mixins:[M],watch:{order(){this.currentOrder=this.order,this.isPaid=this.currentOrder.is_paid}}},S={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog modal-xl",role:"document"},P={class:"modal-content border-0"},q=t("div",{class:"modal-header text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},E={class:"row"},N={class:"col-md-4"},F=t("h3",null,"用戶資料",-1),U={class:"table"},z=t("th",{style:{width:"100px"}},"姓名",-1),A=t("th",null,"Email",-1),G=t("th",null,"電話",-1),H=t("th",null,"地址",-1),J={class:"col-md-8"},K=t("h3",null,"訂單細節",-1),Q={class:"table"},R=t("th",{style:{width:"100px"}},"訂單編號",-1),W=t("th",null,"下單時間",-1),X=t("tr",null,[t("th",null,"付款時間"),t("td",null,[t("span",null," paid_date "),t("span",null,"時間不正確")])],-1),Z=t("th",null,"付款狀態",-1),tt={key:0,class:"text-success"},et={key:1,class:"text-muted"},st=t("th",null,"總金額",-1),ot=t("h3",null,"選購商品",-1),lt={class:"table"},nt=t("thead",null,[t("tr")],-1),at={class:"text-end"},dt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 "),t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"確認")],-1);function rt(e,r,l,u,o,h){return a(),d("div",S,[t("div",T,[t("div",P,[q,t("div",B,[t("div",E,[t("div",N,[F,t("table",U,[t("tbody",null,[t("tr",null,[z,t("td",null,s(o.currentOrder.user.name),1)]),t("tr",null,[A,t("td",null,s(o.currentOrder.user.email),1)]),t("tr",null,[G,t("td",null,s(o.currentOrder.user.tel),1)]),t("tr",null,[H,t("td",null,s(o.currentOrder.user.address),1)])])])]),t("div",J,[K,t("table",Q,[t("tbody",null,[t("tr",null,[R,t("td",null,s(o.currentOrder.id),1)]),t("tr",null,[W,t("td",null,s(e.$dayjs(new Date(o.currentOrder.create_at*1e3)).format("YYYY-MM-DD")),1)]),X,t("tr",null,[Z,t("td",null,[o.isPaid?(a(),d("strong",tt,"已付款")):(a(),d("span",et,"尚未付款"))])]),t("tr",null,[st,t("td",null," $"+s(o.currency(o.currentOrder.total)),1)])])]),ot,t("table",lt,[nt,t("tbody",null,[(a(!0),d(m,null,g(o.currentOrder.products,c=>(a(),d("tr",{key:c.id},[t("th",null,s(c.product.title),1),t("td",null,s(c.qty)+" / "+s(c.product.unit),1),t("td",at," $"+s(o.currency(c.final_total)),1)]))),128))])])])])]),dt])])],512)}const it=f(I,[["render",rt]]),ct={props:{deleteItem:{}},data(){return{modal:{}}},mixins:[M]},ut={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},ht={class:"modal-dialog",role:"document"},_t={class:"modal-content border-0"},pt={class:"modal-header bg-danger text-white"},mt={class:"modal-title"},bt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),gt={class:"modal-body"},yt={class:"text-danger"},ft={class:"modal-footer"},$t=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function vt(e,r,l,u,o,h){return a(),d("div",ut,[t("div",ht,[t("div",_t,[t("div",pt,[t("h5",mt,[t("span",null,"刪除 "+s(l.deleteItem.title||l.deleteItem.id),1)]),bt]),t("div",gt,[y(" 是否刪除 "),t("strong",yt,s(l.deleteItem.title||l.deleteItem.id),1),y(" (刪除後將無法恢復)。 ")]),t("div",ft,[$t,t("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:r[0]||(r[0]=c=>e.$emit("del-item"))},"確認刪除 ")])])])],512)}const Mt=f(ct,[["render",vt]]),$=k("orderStore",{state:()=>({orderList:[],pagination:{},toastMessages:[],isLoading:!1}),actions:{async getOrderList(e=1){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/orders/?page=${e}`;this.isLoading=!0,await b.get(r).then(l=>{l.data.success?this.orderList=l.data.orders:this.toastMessages.push({style:"danger",title:"取得列表失敗",content:l.data.message.join("、")})}),this.isLoading=!1},async deleteOrder(e){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/order/${e}`;this.isLoading=!0,await b.delete(r).then(l=>{l.data.success?(this.getOrderList(),this.toastMessages.push({style:"success",title:"刪除成功",content:""})):this.toastMessages.push({style:"danger",title:"刪除失敗",content:l.data.message.join("、")})}),this.isLoading=!1},async changeOrder(e){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/order/${e}`,l=this.orderList.find(u=>u.id===e);this.isLoading=!0,await b.put(r,{data:l}).then(u=>{u.data.success?(this.getOrderList(),this.toastMessages.push({style:"success",title:"編輯成功",content:""})):this.toastMessages.push({style:"danger",title:"編輯失敗",content:u.data.message.join("、")})}),this.isLoading=!1}}}),Ot={components:{OrderModal:it,DeleteModal:Mt,ToastMessage:V},data(){return{currency:v,currentList:{}}},computed:{...w($,["orderList","isLoading","toastMessages"])},methods:{...D($,["getOrderList","deleteOrder","changeOrder"]),openOrder(e){this.currentList={...e},this.$refs.orderModal.showModal()},openDelete(e){this.currentList={...e},this.$refs.deleteModal.showModal()}},created(){this.getOrderList()}},Lt=t("h4",{class:"fw-bold py-3 mb-4"},[t("span",{class:"text-muted fw-light fs-4"},"Pages /"),y(" Order 訂單")],-1),xt={class:"card"},kt=t("div",{class:"card-header d-flex align-items-center"},[t("h5",{class:"mb-0"},"Order 訂單")],-1),wt={class:"table-responsive text-nowrap"},Dt={class:"table"},Ct=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Yt={class:"table-border-bottom-0"},jt={class:"list-unstyled"},Vt={class:"text-right"},It={class:"form-check form-switch"},St=["onUpdate:modelValue","onChange"],Tt={class:"form-check-label"},Pt={key:0},qt={key:1},Bt={class:"btn-group"},Et=["onClick"],Nt=["onClick"];function Ft(e,r,l,u,o,h){const c=_("LoadingOverlay"),O=_("ToastMessage"),L=_("OrderModal"),x=_("DeleteModal");return a(),d(m,null,[p(c,{active:e.isLoading},null,8,["active"]),p(O,{"toast-msg":e.toastMessages},null,8,["toast-msg"]),Lt,t("div",xt,[kt,t("div",wt,[t("table",Dt,[Ct,t("tbody",Yt,[(a(!0),d(m,null,g(e.orderList,n=>(a(),d("tr",{key:n.id,class:C({"text-secondary":!n.is_paid})},[t("td",null,s(e.$dayjs(n.create_at*1e3).format("YYYY-MM-DD")),1),t("td",null,s(n.user.email),1),t("td",null,[t("ul",jt,[(a(!0),d(m,null,g(n.products,i=>(a(),d("li",{key:i.id},s(i.product.title)+" / 數量："+s(i.qty)+s(i.product.unit),1))),128))])]),t("td",Vt,"$"+s(o.currency(n.total)),1),t("td",null,[t("div",It,[Y(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>n.is_paid=i,onChange:i=>e.changeOrder(n.id)},null,40,St),[[j,n.is_paid]]),t("label",Tt,[n.is_paid?(a(),d("span",Pt,"已付款")):(a(),d("span",qt,"未付款"))])])]),t("td",null,[t("div",Bt,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:i=>h.openOrder(n)},"檢視",8,Et),t("button",{class:"btn btn-outline-danger btn-sm",onClick:i=>h.openDelete(n)},"刪除",8,Nt)])])],2))),128))])])])]),p(L,{ref:"orderModal",order:o.currentList},null,8,["order"]),p(x,{ref:"deleteModal","delete-item":o.currentList,onDelItem:r[0]||(r[0]=n=>e.deleteOrder(o.currentList.id))},null,8,["delete-item"])],64)}const Gt=f(Ot,[["render",Ft]]);export{Gt as default};
