import{c as v,m as O}from"./modalMixins-4c9f09fb.js";import{_ as g,o as d,c as a,a as t,t as s,F as _,r as y,j as f,d as M,e as m,k,m as w,l as p,n as b,q as D,w as C,h as Y}from"./index-e5bcf3e4.js";const V={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{currency:v,currentOrder:{user:{}},isPaid:!1}},mixins:[O],watch:{order(){this.currentOrder=this.order,this.isPaid=this.currentOrder.is_paid}}},I={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},j={class:"modal-content border-0"},q=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},E={class:"row"},N={class:"col-md-4"},P=t("h3",null,"用戶資料",-1),F={class:"table"},U=t("th",{style:{width:"100px"}},"姓名",-1),z=t("th",null,"Email",-1),A=t("th",null,"電話",-1),T=t("th",null,"地址",-1),G={class:"col-md-8"},H=t("h3",null,"訂單細節",-1),J={class:"table"},K=t("th",{style:{width:"100px"}},"訂單編號",-1),Q=t("th",null,"下單時間",-1),R=t("tr",null,[t("th",null,"付款時間"),t("td",null,[t("span",null," paid_date "),t("span",null,"時間不正確")])],-1),W=t("th",null,"付款狀態",-1),X={key:0,class:"text-success"},Z={key:1,class:"text-muted"},tt=t("th",null,"總金額",-1),et=t("h3",null,"選購商品",-1),st={class:"table"},ot=t("thead",null,[t("tr")],-1),lt={class:"text-end"},nt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 "),t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"確認")],-1);function dt(e,r,l,u,o,h){return d(),a("div",I,[t("div",S,[t("div",j,[q,t("div",B,[t("div",E,[t("div",N,[P,t("table",F,[t("tbody",null,[t("tr",null,[U,t("td",null,s(o.currentOrder.user.name),1)]),t("tr",null,[z,t("td",null,s(o.currentOrder.user.email),1)]),t("tr",null,[A,t("td",null,s(o.currentOrder.user.tel),1)]),t("tr",null,[T,t("td",null,s(o.currentOrder.user.address),1)])])])]),t("div",G,[H,t("table",J,[t("tbody",null,[t("tr",null,[K,t("td",null,s(o.currentOrder.id),1)]),t("tr",null,[Q,t("td",null,s(e.$dayjs(new Date(o.currentOrder.create_at*1e3)).format("YYYY-MM-DD")),1)]),R,t("tr",null,[W,t("td",null,[o.isPaid?(d(),a("strong",X,"已付款")):(d(),a("span",Z,"尚未付款"))])]),t("tr",null,[tt,t("td",null," $"+s(o.currency(o.currentOrder.total)),1)])])]),et,t("table",st,[ot,t("tbody",null,[(d(!0),a(_,null,y(o.currentOrder.products,c=>(d(),a("tr",{key:c.id},[t("th",null,s(c.product.title),1),t("td",null,s(c.qty)+" / "+s(c.product.unit),1),t("td",lt," $"+s(o.currency(c.final_total)),1)]))),128))])])])])]),nt])])],512)}const at=g(V,[["render",dt]]),rt={props:{deleteItem:{}},data(){return{modal:{}}},mixins:[O]},it={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},ct={class:"modal-dialog",role:"document"},ut={class:"modal-content border-0"},ht={class:"modal-header bg-danger text-white"},_t={class:"modal-title"},mt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),pt={class:"modal-body"},bt={class:"text-danger"},yt={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function ft(e,r,l,u,o,h){return d(),a("div",it,[t("div",ct,[t("div",ut,[t("div",ht,[t("h5",_t,[t("span",null,"刪除 "+s(l.deleteItem.title||l.deleteItem.id),1)]),mt]),t("div",pt,[f(" 是否刪除 "),t("strong",bt,s(l.deleteItem.title||l.deleteItem.id),1),f(" (刪除後將無法恢復)。 ")]),t("div",yt,[gt,t("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:r[0]||(r[0]=c=>e.$emit("del-item"))},"確認刪除 ")])])])],512)}const $t=g(rt,[["render",ft]]),$=M("orderStore",{state:()=>({orderList:[],pagination:{},isLoading:!1}),actions:{async getOrderList(e=1){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/orders/?page=${e}`;this.isLoading=!0,await m.get(r).then(l=>{l.data.success?(this.orderList=l.data.orders,this.isLoading=!1):console.log(l.data.messages)})},async deleteOrder(e){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/order/${e}`;await m.delete(r).then(l=>{l.data.success?this.getOrderList():console.log(l.data.message)})},async changeOrder(e){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/order/${e}`,l=this.orderList.find(u=>u.id===e);await m.put(r,{data:l}).then(u=>{u.data.success?this.getOrderList():console.log(u.data.message)})}}}),vt={components:{OrderModal:at,DeleteModal:$t},data(){return{currency:v,currentList:{}}},computed:{...k($,["orderList","isLoading"])},methods:{...w($,["getOrderList","deleteOrder","changeOrder"]),openOrder(e){this.currentList={...e},this.$refs.orderModal.showModal()},openDelete(e){this.currentList={...e},this.$refs.deleteModal.showModal()}},created(){this.getOrderList()}},Ot={class:"table mt-4"},Lt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),xt={class:"list-unstyled"},Mt={class:"text-right"},kt={class:"form-check form-switch"},wt=["onUpdate:modelValue","onChange"],Dt={class:"form-check-label"},Ct={key:0},Yt={key:1},Vt={class:"btn-group"},It=["onClick"],St=["onClick"];function jt(e,r,l,u,o,h){const c=p("LoadingOverlay"),L=p("OrderModal"),x=p("DeleteModal");return d(),a(_,null,[b(c,{active:e.isLoading},null,8,["active"]),t("table",Ot,[Lt,t("tbody",null,[(d(!0),a(_,null,y(e.orderList,n=>(d(),a("tr",{key:n.id,class:D({"text-secondary":!n.is_paid})},[t("td",null,s(e.$dayjs(n.create_at*1e3).format("YYYY-MM-DD")),1),t("td",null,s(n.user.email),1),t("td",null,[t("ul",xt,[(d(!0),a(_,null,y(n.products,i=>(d(),a("li",{key:i.id},s(i.product.title)+" / 數量："+s(i.qty)+s(i.product.unit),1))),128))])]),t("td",Mt,"$"+s(o.currency(n.total)),1),t("td",null,[t("div",kt,[C(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>n.is_paid=i,onChange:i=>e.changeOrder(n.id)},null,40,wt),[[Y,n.is_paid]]),t("label",Dt,[n.is_paid?(d(),a("span",Ct,"已付款")):(d(),a("span",Yt,"未付款"))])])]),t("td",null,[t("div",Vt,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:i=>h.openOrder(n)},"檢視",8,It),t("button",{class:"btn btn-outline-danger btn-sm",onClick:i=>h.openDelete(n)},"刪除",8,St)])])],2))),128))])]),b(L,{ref:"orderModal",order:o.currentList},null,8,["order"]),b(x,{ref:"deleteModal","delete-item":o.currentList,onDelItem:r[0]||(r[0]=n=>e.deleteOrder(o.currentList.id))},null,8,["delete-item"])],64)}const Et=g(vt,[["render",jt]]);export{Et as default};
