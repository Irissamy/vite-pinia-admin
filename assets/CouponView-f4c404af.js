import{c as w,d as M}from"./filterFn-431caa88.js";import{m as k}from"./modalMixins-93af5dc1.js";import{d as L,e as b,m as y,_ as g,o as i,c as d,a as o,w as c,v as p,h as $,b as h,k as I,l as f,n as v,F as C,r as N,t as _}from"./index-d4c81532.js";const m=L("couponStore",{state:()=>({couponList:[],currentCoupon:{},isLoading:!1}),actions:{async getCoupon(s=1){const t=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupons/?page=${s}`;this.isLoading=!0,await b.get(t).then(a=>{this.couponList=a.data.coupons,this.isLoading=!1})},async updateCoupon(s){this.currentCoupon=s;let t="https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon",a="post";s.isNew||(t=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon/${s.id}`,a="put"),await b[a](t,{data:this.currentCoupon}).then(u=>{u.data.success?this.getCoupon():console.log(u.data.message)})}}}),V={mixins:[k],props:{coupon:{type:Object}},data(){return{couponInfo:{},due_date:""}},watch:{coupon(){this.couponInfo=this.coupon;const s=new Date(this.couponInfo.due_date*1e3).toISOString().split("T");[this.due_date]=s},due_date(){this.couponInfo.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{...y(m,["updateCoupon"])}},S={class:"modal fade",id:"cuponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},D={class:"modal-dialog",role:"document"},U={class:"modal-content"},O=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠卷"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},B={class:"mb-3"},A=o("label",{for:"title"},"標題",-1),F={class:"mb-3"},j=o("label",{for:"coupon_code"},"優惠碼",-1),E={class:"mb-3"},q=o("label",{for:"due_date"},"到期日",-1),z={class:"mb-3"},G=o("label",{for:"price"},"折扣百分比",-1),H={class:"mb-3"},J={class:"form-check"},K=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),P={class:"modal-footer"},Q=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function R(s,t,a,u,e,r){return i(),d("div",S,[o("div",D,[o("div",U,[O,o("div",T,[o("div",B,[A,c(o("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=n=>e.couponInfo.title=n)},null,512),[[p,e.couponInfo.title]])]),o("div",F,[j,c(o("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":t[1]||(t[1]=n=>e.couponInfo.code=n)},null,512),[[p,e.couponInfo.code]])]),o("div",E,[q,c(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=n=>e.due_date=n)},null,512),[[p,e.due_date]])]),o("div",z,[G,c(o("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":t[3]||(t[3]=n=>e.couponInfo.percent=n)},null,512),[[p,e.couponInfo.percent]])]),o("div",H,[o("div",J,[c(o("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":t[4]||(t[4]=n=>e.couponInfo.is_enabled=n),"true-value":0,"false-value":1},null,512),[[$,e.couponInfo.is_enabled]]),K])])]),o("div",P,[Q,o("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[5]||(t[5]=h(n=>s.updateCoupon(e.couponInfo),["prevent"]))},"更新優惠券 ")])])])],512)}const W=g(V,[["render",R]]),X={components:{CouponModal:W},data(){return{currency:w,date:M,isLoading:!1,isNew:!1,currentCoupon:{}}},computed:{...I(m,["couponList"])},methods:{...y(m,["getCoupon"]),openModal(s,t){s?(this.isNew=s,this.currentCoupon={is_enabled:0,percent:100,due_date:new Date().getTime()/1e3,isNew:this.isNew}):(this.isNew=!1,this.currentCoupon={...t,isNew:this.isNew}),this.$refs.CouponModal.showModal()}},created(){this.getCoupon()}},Y={class:"text-end"},Z={class:"table mt-4"},oo=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),to={key:0,class:"text-success"},eo={key:1,class:"text-muted"},so={class:"btn-group"},no=["onClick"],lo=o("button",{class:"btn btn-outline-danger btn-sm"},"刪除",-1);function ao(s,t,a,u,e,r){const n=f("LoadingOverlay"),x=f("CouponModal");return i(),d(C,null,[v(n,{active:e.isLoading},null,8,["active"]),o("div",Y,[o("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=h(l=>r.openModal(!0),["prevent"]))},"建立新的優惠券")]),o("table",Z,[oo,o("tbody",null,[(i(!0),d(C,null,N(s.couponList,l=>(i(),d("tr",{key:l.id},[o("td",null,_(l.title),1),o("td",null,_(l.percent)+"%",1),o("td",null,_(e.date(l.due_date)),1),o("td",null,[l.is_enabled===0?(i(),d("span",to,"啟用")):(i(),d("span",eo,"未啟用"))]),o("td",null,[o("div",so,[o("button",{class:"btn btn-outline-primary btn-sm",onClick:h(io=>r.openModal(!1,l),["prevent"])},"編輯",8,no),lo])])]))),128))])]),v(x,{ref:"CouponModal",coupon:e.currentCoupon},null,8,["coupon"])],64)}const ro=g(X,[["render",ao]]);export{ro as default};
