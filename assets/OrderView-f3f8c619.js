import{c as v,m as O}from"./modalMixins-ea79b0a2.js";import{_ as $,o as n,c as a,a as t,t as s,F as h,n as y,i as g,k as M,l as m,x as k,m as w,r as p,e as b,y as D,b as C,q as Y}from"./index-58272815.js";const V={name:"orderModal",props:{order:{type:Object,default(){return{}}}},data(){return{currency:v,currentOrder:{user:{}},isPaid:!1}},mixins:[O],watch:{order(){this.currentOrder=this.order,this.isPaid=this.currentOrder.is_paid}}},I={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},S={class:"modal-dialog modal-xl",role:"document"},P={class:"modal-content border-0"},j=t("div",{class:"modal-header text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),q={class:"modal-body"},B={class:"row"},E={class:"col-md-4"},N=t("h3",null,"用戶資料",-1),F={class:"table"},U=t("th",{style:{width:"100px"}},"姓名",-1),z=t("th",null,"Email",-1),A=t("th",null,"電話",-1),T=t("th",null,"地址",-1),G={class:"col-md-8"},H=t("h3",null,"訂單細節",-1),J={class:"table"},K=t("th",{style:{width:"100px"}},"訂單編號",-1),Q=t("th",null,"下單時間",-1),R=t("tr",null,[t("th",null,"付款時間"),t("td",null,[t("span",null," paid_date "),t("span",null,"時間不正確")])],-1),W=t("th",null,"付款狀態",-1),X={key:0,class:"text-success"},Z={key:1,class:"text-muted"},tt=t("th",null,"總金額",-1),et=t("h3",null,"選購商品",-1),st={class:"table"},ot=t("thead",null,[t("tr")],-1),lt={class:"text-end"},dt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 "),t("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal"},"確認")],-1);function nt(e,r,l,u,o,_){return n(),a("div",I,[t("div",S,[t("div",P,[j,t("div",q,[t("div",B,[t("div",E,[N,t("table",F,[t("tbody",null,[t("tr",null,[U,t("td",null,s(o.currentOrder.user.name),1)]),t("tr",null,[z,t("td",null,s(o.currentOrder.user.email),1)]),t("tr",null,[A,t("td",null,s(o.currentOrder.user.tel),1)]),t("tr",null,[T,t("td",null,s(o.currentOrder.user.address),1)])])])]),t("div",G,[H,t("table",J,[t("tbody",null,[t("tr",null,[K,t("td",null,s(o.currentOrder.id),1)]),t("tr",null,[Q,t("td",null,s(e.$dayjs(new Date(o.currentOrder.create_at*1e3)).format("YYYY-MM-DD")),1)]),R,t("tr",null,[W,t("td",null,[o.isPaid?(n(),a("strong",X,"已付款")):(n(),a("span",Z,"尚未付款"))])]),t("tr",null,[tt,t("td",null," $"+s(o.currency(o.currentOrder.total)),1)])])]),et,t("table",st,[ot,t("tbody",null,[(n(!0),a(h,null,y(o.currentOrder.products,c=>(n(),a("tr",{key:c.id},[t("th",null,s(c.product.title),1),t("td",null,s(c.qty)+" / "+s(c.product.unit),1),t("td",lt," $"+s(o.currency(c.final_total)),1)]))),128))])])])])]),dt])])],512)}const at=$(V,[["render",nt]]),rt={props:{deleteItem:{}},data(){return{modal:{}}},mixins:[O]},it={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},ct={class:"modal-dialog",role:"document"},ut={class:"modal-content border-0"},_t={class:"modal-header bg-danger text-white"},ht={class:"modal-title"},mt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),pt={class:"modal-body"},bt={class:"text-danger"},yt={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1);function $t(e,r,l,u,o,_){return n(),a("div",it,[t("div",ct,[t("div",ut,[t("div",_t,[t("h5",ht,[t("span",null,"刪除 "+s(l.deleteItem.title||l.deleteItem.id),1)]),mt]),t("div",pt,[g(" 是否刪除 "),t("strong",bt,s(l.deleteItem.title||l.deleteItem.id),1),g(" (刪除後將無法恢復)。 ")]),t("div",yt,[gt,t("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:r[0]||(r[0]=c=>e.$emit("del-item"))},"確認刪除 ")])])])],512)}const ft=$(rt,[["render",$t]]),f=M("orderStore",{state:()=>({orderList:[],pagination:{},isLoading:!1}),actions:{async getOrderList(e=1){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/orders/?page=${e}`;this.isLoading=!0,await m.get(r).then(l=>{l.data.success?(this.orderList=l.data.orders,this.isLoading=!1):console.log(l.data.messages)})},async deleteOrder(e){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/order/${e}`;await m.delete(r).then(l=>{l.data.success?this.getOrderList():console.log(l.data.message)})},async changeOrder(e){const r=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/order/${e}`,l=this.orderList.find(u=>u.id===e);await m.put(r,{data:l}).then(u=>{u.data.success?this.getOrderList():console.log(u.data.message)})}}}),vt={components:{OrderModal:at,DeleteModal:ft},data(){return{currency:v,currentList:{}}},computed:{...k(f,["orderList","isLoading"])},methods:{...w(f,["getOrderList","deleteOrder","changeOrder"]),openOrder(e){this.currentList={...e},this.$refs.orderModal.showModal()},openDelete(e){this.currentList={...e},this.$refs.deleteModal.showModal()}},created(){this.getOrderList()}},Ot=t("h4",{class:"fw-bold py-3 mb-4"},[t("span",{class:"text-muted fw-light fs-4"},"Pages /"),g(" Order 訂單")],-1),xt={class:"card"},Lt=t("div",{class:"card-header d-flex align-items-center"},[t("h5",{class:"mb-0"},"Order 訂單")],-1),Mt={class:"table-responsive text-nowrap"},kt={class:"table"},wt=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Dt={class:"table-border-bottom-0"},Ct={class:"list-unstyled"},Yt={class:"text-right"},Vt={class:"form-check form-switch"},It=["onUpdate:modelValue","onChange"],St={class:"form-check-label"},Pt={key:0},jt={key:1},qt={class:"btn-group"},Bt=["onClick"],Et=["onClick"];function Nt(e,r,l,u,o,_){const c=p("LoadingOverlay"),x=p("OrderModal"),L=p("DeleteModal");return n(),a(h,null,[b(c,{active:e.isLoading},null,8,["active"]),Ot,t("div",xt,[Lt,t("div",Mt,[t("table",kt,[wt,t("tbody",Dt,[(n(!0),a(h,null,y(e.orderList,d=>(n(),a("tr",{key:d.id,class:D({"text-secondary":!d.is_paid})},[t("td",null,s(e.$dayjs(d.create_at*1e3).format("YYYY-MM-DD")),1),t("td",null,s(d.user.email),1),t("td",null,[t("ul",Ct,[(n(!0),a(h,null,y(d.products,i=>(n(),a("li",{key:i.id},s(i.product.title)+" / 數量："+s(i.qty)+s(i.product.unit),1))),128))])]),t("td",Yt,"$"+s(o.currency(d.total)),1),t("td",null,[t("div",Vt,[C(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":i=>d.is_paid=i,onChange:i=>e.changeOrder(d.id)},null,40,It),[[Y,d.is_paid]]),t("label",St,[d.is_paid?(n(),a("span",Pt,"已付款")):(n(),a("span",jt,"未付款"))])])]),t("td",null,[t("div",qt,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:i=>_.openOrder(d)},"檢視",8,Bt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:i=>_.openDelete(d)},"刪除",8,Et)])])],2))),128))])])])]),b(x,{ref:"orderModal",order:o.currentList},null,8,["order"]),b(L,{ref:"deleteModal","delete-item":o.currentList,onDelItem:r[0]||(r[0]=d=>e.deleteOrder(o.currentList.id))},null,8,["delete-item"])],64)}const zt=$(vt,[["render",Nt]]);export{zt as default};
