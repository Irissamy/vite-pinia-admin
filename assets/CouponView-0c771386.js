import{m as x,c as L,d as M}from"./modalMixins-3f1f6f99.js";import{e as k,f as _,m as g,_ as y,o as l,c as d,a as o,w as c,v as p,j as I,b as r,n as N,r as f,q as v,F as C,g as V,t as m}from"./index-56adcaf2.js";const b=k("couponStore",{state:()=>({couponList:[],currentCoupon:{},isLoading:!1}),actions:{async getCoupon(t=1){const e=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupons/?page=${t}`;this.isLoading=!0,await _.get(e).then(a=>{this.couponList=a.data.coupons,this.isLoading=!1})},async updateCoupon(t){this.currentCoupon=t;let e="https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon",a="post";this.isLoading=!0,t.isNew||(e=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon/${t.id}`,a="put"),await _[a](e,{data:this.currentCoupon}).then(u=>{u.data.success?(this.getCoupon(),this.isLoading=!1):console.log(u.data.message)})},async deleteCoupon(t){const e=`https://vue3-course-api.hexschool.io/api/iris-lai-api/admin/coupon/${t}`;this.isLoading=!0,await _.delete(e).then(a=>{a.data.success?(this.getCoupon(),this.isLoading=!1):console.log(a.data.message)})}}}),S={mixins:[x],props:{coupon:{type:Object}},data(){return{couponInfo:{},due_date:""}},watch:{coupon(){this.couponInfo=this.coupon;const t=new Date(this.couponInfo.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.couponInfo.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{...g(b,["updateCoupon"])}},D={class:"modal fade",id:"cuponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog",role:"document"},O={class:"modal-content"},T=o("div",{class:"modal-header"},[o("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠卷"),o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),B={class:"modal-body"},j={class:"mb-3"},A=o("label",{for:"title"},"標題",-1),F={class:"mb-3"},q=o("label",{for:"coupon_code"},"優惠碼",-1),E={class:"mb-3"},z=o("label",{for:"due_date"},"到期日",-1),G={class:"mb-3"},H=o("label",{for:"price"},"折扣百分比",-1),J={class:"mb-3"},K={class:"form-check"},P=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Q={class:"modal-footer"},R=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function W(t,e,a,u,s,h){return l(),d("div",D,[o("div",U,[o("div",O,[T,o("div",B,[o("div",j,[A,c(o("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=n=>s.couponInfo.title=n)},null,512),[[p,s.couponInfo.title]])]),o("div",F,[q,c(o("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=n=>s.couponInfo.code=n)},null,512),[[p,s.couponInfo.code]])]),o("div",E,[z,c(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=n=>s.due_date=n)},null,512),[[p,s.due_date]])]),o("div",G,[H,c(o("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=n=>s.couponInfo.percent=n)},null,512),[[p,s.couponInfo.percent]])]),o("div",J,[o("div",K,[c(o("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=n=>s.couponInfo.is_enabled=n),"true-value":1,"false-value":0},null,512),[[I,s.couponInfo.is_enabled]]),P])])]),o("div",Q,[R,o("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[5]||(e[5]=r(n=>t.updateCoupon(s.couponInfo),["prevent"]))},"更新優惠券 ")])])])],512)}const X=y(S,[["render",W]]),Y={components:{CouponModal:X},data(){return{currency:L,date:M,isNew:!1,currentCoupon:{}}},computed:{...N(b,["couponList","isLoading"])},methods:{...g(b,["getCoupon","deleteCoupon"]),openModal(t,e){t?(this.isNew=t,this.currentCoupon={is_enabled:0,percent:100,due_date:new Date().getTime()/1e3,isNew:this.isNew}):(this.isNew=!1,this.currentCoupon={...e,isNew:this.isNew}),this.$refs.CouponModal.showModal()}},created(){this.getCoupon()}},Z={class:"text-end"},oo={class:"table mt-4"},eo=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",null,"折扣百分比"),o("th",null,"到期日"),o("th",null,"是否啟用"),o("th",null,"編輯")])],-1),to={key:0,class:"text-success"},so={key:1,class:"text-muted"},no={class:"btn-group"},ao=["onClick"],io=["onClick"];function lo(t,e,a,u,s,h){const n=f("LoadingOverlay"),w=f("CouponModal");return l(),d(C,null,[v(n,{active:t.isLoading},null,8,["active"]),o("div",Z,[o("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=r(i=>h.openModal(!0),["prevent"]))},"建立新的優惠券")]),o("table",oo,[eo,o("tbody",null,[(l(!0),d(C,null,V(t.couponList,i=>(l(),d("tr",{key:i.id},[o("td",null,m(i.title),1),o("td",null,m(i.percent)+"%",1),o("td",null,m(s.date(i.due_date)),1),o("td",null,[i.is_enabled===1?(l(),d("span",to,"啟用")):(l(),d("span",so,"未啟用"))]),o("td",null,[o("div",no,[o("button",{class:"btn btn-outline-primary btn-sm",onClick:r($=>h.openModal(!1,i),["prevent"])},"編輯",8,ao),o("button",{class:"btn btn-outline-danger btn-sm",onClick:r($=>t.deleteCoupon(i.id),["prevent"])},"刪除",8,io)])])]))),128))])]),v(w,{ref:"CouponModal",coupon:s.currentCoupon},null,8,["coupon"])],64)}const po=y(Y,[["render",lo]]);export{po as default};
